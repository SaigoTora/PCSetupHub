@using PCSetupHub.Data.Models.Users

@model ChatViewModel

@{
    ViewData["Title"] = "Chat";

    <link rel="stylesheet" href="~/css/message.css" />

    int? userId = User.GetId();
    bool isChatOneToOne = Model.Participants?.Count == 1;
}

@if (Model.Participants != null)
{
    @if (isChatOneToOne)
    {
        User? participant = Model.Participants.FirstOrDefault();

        if (participant != null)
        {
            <div class="d-flex justify-content-center align-items-center">
                <div class="d-flex align-items-center ms-1 me-2">
                    <img src="@participant.AvatarUrl" alt="User avatar @participant.Login"
                         title="@participant.Login" width="60" height="60"
                         class="user-avatar" />
                </div>
                <div class="user-login">@participant.Login</div>
            </div>
        }
    }
}
@if (Model.Messages != null)
{
    <div id="messageList" class="d-flex flex-column-reverse">
        @foreach (Message message in Model.Messages)
        {
            <div>@message.SenderId: @message.Text (@message.CreatedAt)</div>
        }
    </div>
}

<form id="messages" data-chat-id="@Model.ChatId" data-user-id="@userId">
    <label for="inputMessage">Message</label>
    <input placeholder="Write a message..." type="text" id="inputMessage" autocomplete="off" />

    <button id="sendButton">Send</button>
</form>


<script src="~/js/signalr/dist/browser/signalr.js"></script>
<script src="~/js/chat.js"></script>